<?php
use DvsaCommon\UrlBuilder\VehicleUrlBuilderWeb;

$this->headLink()->appendStylesheet('/css/jquery.dataTables.css');
echo $this->partial('infoMessages', array('getFromFlash' => true));
echo $this->partial('errorMessages', array('getFromFlash' => true));
?>

<div class="row">
    <div class="col-lg-12">
        <h1>Vehicle Search Results</h1>
        <hr class="hr-thick"/>
    </div>
</div>
<div class="row">
    <div class="col-sm-12">
        <?php $typeInfo = ($this->type == 'registration' ? 'registration mark' : 'VIN/chassis'); ?>
        <h2><?php echo sprintf('Vehicle(s) found with %s "%s"', $typeInfo, $this->search); ?></h2>
    </div>
</div>
<div class="info-notice">
    <p>
        <?php echo sprintf(
            'If these are <strong>not the right results</strong> you can <a href="%s">go back</a>',
            VehicleUrlBuilderWeb::search()
        ); ?>
    </p>
</div>
<div class="row">
    <div class="col-sm-12">
        <div class="table-responsive">
            <!-- NOTE - this table aims to cater with wide-table-data in narrow screens by making a number of columns have a truncate style applied - and echoing the column data in the title attribute.  We can further minimise the width by hiding the VIN (if searched by VIN) or VRM (if search by VRM) accordingly. -->
            <table class="table table-striped nowrap" id="listVehicles" style="width: 100%">
                <thead>
                <tr>
                    <th>VIN/Chassis</th>
                    <th>Registration</th>
                    <th>MOT history</th>
                    <th>Vehicle details</th>
                    <th>Make</th>
                    <th>Model</th>
                    <th>Created</th>
                </tr>
                </thead>
                <tbody>
                <?php $i = 0; ?>
                <?php foreach ($this->vehicles as $vehicleId => $vehicle): ?>
                    <?php $escClass = ($i++ % 2 == 0 ? 'even' : 'odd'); ?>
                    <tr class="<?php echo $escClass; ?>">
                        <td><?php echo $this->escapeHtml($vehicle['vin']); ?></td>
                        <td><?php echo $this->escapeHtml($vehicle['registration']); ?></td>
                        <td>
                            <a href="<?php echo
                                VehicleUrlBuilderWeb::historyMotTests($this->paramObfuscator->obfuscate($vehicleId)) .
                                    '?' . http_build_query($this->searchData) . '&backTo=result';
                            ?>">History</a>
                        </td>
                        <td>
                            <a href="<?php echo
                                VehicleUrlBuilderWeb::vehicle($this->paramObfuscator->obfuscate($vehicleId)) .
                                    '?' . http_build_query($this->searchData);
                            ?>">Details</a></td>
                        <td title="<?php echo $this->escapeHtmlAttr($vehicle['make']); ?>"><?php echo $this->escapeHtml($vehicle['make']); ?></td>
                        <td title="<?php echo $this->escapeHtmlAttr($vehicle['model']); ?>"><?php echo $this->escapeHtml($vehicle['model']); ?></td>
                        <td><?php echo $this->escapeHtml($vehicle['displayDate']); ?></td>
                    </tr>
                <?php endforeach; ?>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        new VehicleResultHelper();
    });
</script>
