!contents -R2 -g -p -f -h
'''In order to confirm the commencement of a retest as a tester I require a button so that I can positively confirm the vehicle in question and the MOT retest record can be created'''

!***< Hidden
*!

''Set up''

!| Date intervals for other tests    |
|DaysInterval|In Future|DateVariable?|
|1           |false    |$yesterday=  |
|20          |false    |$minusTwenty=|

!| GenerateTestDataForOtherFitnesseTests                                                                                                                                                                                           |
|slots|siteId            |siteId?            |testerAuthorisationStatusForGroupA|testerAuthorisationStatusForGroupB|testerUsername  |testerUsername?     |vehicleTestClass|vehicleId?           |status|DateOfTest  |motTestNumber?|
|     |                  |$siteId1=          |${Qualified}                      |${Qualified}                      |                |$testerUsername1=   |${VehicleClass4}|$vehicleId1=         |FAILED|$yesterday  |              |
|     |$siteId1          |                   |                                  |                                  |$testerUsername1|                    |${VehicleClass4}|$vehicleId2=         |FAILED|$yesterday  |              |
|     |$siteId1          |                   |                                  |                                  |$testerUsername1|                    |${VehicleClass4}|$vehicleIdTooOldTest=|FAILED|$minusTwenty|              |
|     |$siteId1          |                   |${Qualified}                      |${Unknown}                        |                |$testerUsernameCatA=|${VehicleClass2}|                     |      |            |              |
|1    |                  |$siteIdWithNoSlots=|${Qualified}                      |${Qualified}                      |                |$testerUsername2=   |${VehicleClass4}|$vehicleId3=         |FAILED|$yesterday  |              |
|     |$siteIdWithNoSlots|                   |${Qualified}                      |${Qualified}                      |$testerUsername2|                    |${VehicleClass4}|                     |PASSED|$yesterday  |              |

!| GenerateTestDataForOtherFitnesseTests|
|schememgtUsername?    |schememgtId?    |
|$nonTesterUsername1=  |$nonTesterId1=  |

''Tests''
Confirm that a vehicle retest can be created given correct input data.

!|Vm 1862 Retest Creation|$testerUsername1                                                                                                                     |
|Vehicle ID              |Vehicle Testing Station Id|Primary Colour|Secondary Colour|Has Registration|Error Message?                                           |
|$vehicleId1             |$siteId1                  |White         |Blue            |TRUE            |                                                         |
|$vehicleId1             |$siteId1                  |White         |Blue            |TRUE            |Re-test already registered for original test             |
|$vehicleIdTooOldTest    |$siteId1                  |White         |Blue            |TRUE            |Original test was performed more than 10 working days ago|
|$vehicleId2             |$siteId1                  |null          |Blue            |TRUE            |Primary Colour is required                               |
|$vehicleId2             |99999999                  |White         |Blue            |TRUE            |Original test was performed at a different VTS           |
|99999999                |99999999                  |White         |Blue            |TRUE            |Original test never performed                            |

Security checks on creating a re-test

!|Vm 1862 Retest Creation                                                                                                                                                   |
|Username           |Vehicle ID |Vehicle Testing Station Id|Primary Colour|Secondary Colour|Has Registration|Error Message?                                                 |
|$nonTesterUsername1|$vehicleId2|$siteId1                  |White         |Blue            |TRUE            |Tester with personId $nonTesterId1 not found                   |
|$testerUsernameCatA|$vehicleId2|$siteId1                  |White         |Blue            |TRUE            |You are not authorised to test a class ${VehicleClass4} vehicle|
|$testerUsername2   |$vehicleId3|$siteIdWithNoSlots        |White         |Blue            |TRUE            |You do not have slots to perform an MOT Test                   |
