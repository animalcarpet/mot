-- ------------------------ --
-- DO NOT EDIT THIS SCRIPT  --
-- ------------------------ --

SET SESSION group_concat_max_len = 9999999999;                                   

SET @TARGET_SCHEMA='#SCHEMA#';
SET @SOURCE_SCHEMA='#SCHEMA#';
SET @TAB_NAME='#TABLENAME#';


-- CURRENT HISTORY TABLES

SELECT CONCAT('-- Create history table for ',@SOURCE_SCHEMA,'.',TABLE_NAME,'
',create_hist,';

') cmd
FROM (
SELECT TABLE_NAME, CONCAT('CREATE TABLE `',@TARGET_SCHEMA,'`.`',LEFT(TABLE_NAME,59), '_hist` (
`hist_id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
`hist_timestamp` TIMESTAMP(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
`',GROUP_CONCAT(CONCAT (COLUMN_NAME, '` ',COLUMN_TYPE) SEPARATOR ',
`'),',
  PRIMARY KEY (`hist_id`),
  UNIQUE INDEX uk_', LEFT(TABLE_NAME,59), '_hist_id_version', ' (`id`,`version`)) ENGINE=InnoDB') AS create_hist
FROM information_schema.COLUMNS 
WHERE TABLE_SCHEMA = @SOURCE_SCHEMA
AND TABLE_NAME = @TAB_NAME
GROUP BY TABLE_NAME ) tmp_table
;



-- CORRECT KDD069-COMPLIANT HISTORY TABLES

SELECT CONCAT('-- Create history table for ',@SOURCE_SCHEMA,'.',TABLE_NAME,'
',create_hist,';

') cmd
FROM (
SELECT TABLE_NAME, CONCAT('CREATE TABLE `',LEFT(TABLE_NAME,59), '_hist` (
`hist_id` bigint unsigned not null auto_increment,
`',GROUP_CONCAT(CONCAT (COLUMN_NAME, '` ',COLUMN_TYPE) SEPARATOR ',
`'),',
`created_by` int(10) unsigned not null,
`created_on` timestamp(6) null default null,
`last_modified_by` int(10) unsigned not null,
`last_modified_on` timestamp(6) null default null,
`version` int(10) unsigned,
`expired_by` int unsigned,
`expired_on` timestamp(6) null default null,
  PRIMARY KEY (`hist_id`),
  UNIQUE INDEX uk_', LEFT(TABLE_NAME,59), '_hist_id_version', ' (`id`,`version`)) ENGINE=InnoDB') AS create_hist
FROM information_schema.COLUMNS 
WHERE TABLE_SCHEMA = @SOURCE_SCHEMA
AND TABLE_NAME = @TAB_NAME
AND COLUMN_NAME not in ('created_by', 'created_on', 'last_modified_by', 'last_modified_on', 'version')
GROUP BY TABLE_NAME ) tmp_table;










