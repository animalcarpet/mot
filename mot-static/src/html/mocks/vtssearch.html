<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>MOT Modernisation</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Le styles -->
	<link href="/css/bootstrap.min.css" media="screen" rel="stylesheet" type="text/css">
	<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">
	<link href="/css/enforcement.css" media="screen" rel="stylesheet" type="text/css">
    <!--link href="/css/form-styles.css" media="screen" rel="stylesheet" type="text/css"-->
	<link href="https://assets.digital.cabinet-office.gov.uk/static/favicon-447e4ac1ab790342660eacfe3dcce264.ico" rel="shortcut icon" type="image/vnd.microsoft.icon">
	<!-- Scripts -->
	<script type="text/javascript" src="/js/libraries.min.js"></script>
	<script type="text/javascript" src="/js/typeahead.min.js"></script>

    <script type="text/javascript" src="/js/jquery.validate.min.js"></script>
    <script type="text/javascript" src="/js/additional-methods.min.js"></script>
	<!--[if lt IE 9]><script type="text/javascript" src="/js/lt.ie9.min.js"></script><![endif]-->
 
</head>
<body class="not-fixed">
	<div class="navbar">
			<div class="container">
				<h2>DVSA MOT </h2>
			</div>
	</div>

	<div class="container">
		<div class="row">
			<!-- Note to PHP developers -- class names and id names liable to change -->
			<div class="col-lg-12 user-banner">
			<!--will soon be div class="col-lg-12 user-banner" 		  -->	
				<p>
					<strong>Nigel Sedgwick</strong> - Vehicle Examiner                                                
				</p>		
			</div>
		</div>

        <div id="validation-summary-id" ></div>
        
        
	<form id="vts-search-form" action="listMOTs.html" method="GET">

		<div style="padding-top:3em;" >
			<!-- Give it bit of vertical space -->
		</div>

		<div class="row form-group" >
            <div class="col-sm-4">
                <label for="searchEntity" class="control-label primary-item-large">
                	Search MOT tests by...  
                </label>
            </div>
            <div class="col-sm-3">
            	<select class="form-control"  id="searchEntity" >
                    <option value="VTS">Site (recent tests)</option>
                    <option value="VTS-date">Site (by date range)</option>
                    <option value="Tester-date">Tester (by date range)</option>
                    <option value="Registration">Registration</option> 
                    <option value="VIN-Chassis">VIN/Chassis</option>                
            	</select>
            </div>
        </div>

        <div class="row form-group" id="dateRangeFields">
             <div class="col-sm-2">
            	<!-- From http://alphagov.github.io/design-patterns/guides/date-of-birth.html -->
				<fieldset class="calendar-date"  id="formDate">
			      <legend>From the start of...</legend>
			      <div class="form-group">
			        <label for="month">Month</label>
			        <input type="text" pattern="[0-9]*" id="month1" placeholder="MM" name="month1" maxlength="2" width="2" class="form-control" />
			      </div>
			      <div class="form-group form-group-year">
			        <label for="year">Year</label>
			        <input type="text" pattern="[0-9]*" id="year1" name="year1" placeholder="YYYY" maxlength="4" width="4" class="form-control" />
			      </div>
			    </fieldset>
			</div>
			<div class="col-sm-2">
			    <fieldset class="calendar-date"  id="formDate">
			      <legend>To the end of...</legend>
			      <div class="form-group">
			        <label for="month">Month</label>
			        <input type="text" pattern="[0-9]*" id="month2" placeholder="MM" name="month2" maxlength="2" width="2" class="form-control" />
			      </div>
			      <div class="form-group form-group-year">
			        <label for="year">Year</label>
			        <input type="text" pattern="[0-9]*" id="year2" name="year2" placeholder="YYYY" maxlength="4" width="4" class="form-control" />
			      </div>
			    </fieldset>
            </div>
        </div>

		<div class="row">
			<div class="col-sm-12 col-lg-8 vts-search-panel">
				
				<div class="row">
					<div class="col-sm-12">
						<input type="text" id="vts-search" name="search" value="" required="required" class="form-control" placeholder="eg. V12345" maxlength="60" width="100">
						<button type="submit" class="btn-search" id="test-item-selector-btn-search" >
							<i class="fa fa-search"> </i>
							<span class="visually-hidden">Search</span>
						</button>
					</div>
				</div>
			</div>
		</div>


	</form>
    






<script type="text/javascript">
/* log function - Used to make console logging cross browser */
function log(display) {
    if (typeof window.console !== 'undefined') {console.log(display); }
}

function setupTypeaheadOnVTS() { // Shove this into a function to make it easily re-usable
    $('#vts-search').typeahead([		// typeahead.js usage info here: https://github.com/twitter/typeahead.js
     {
        name: 'vtsData',
        prefetch: '/data/VTS-data.json', // 'remote' is used when the data provided by local & prefetch is 
                                         // insufficient. In order to prevent an obscene number of requests being 
                                         // made to remote endpoint, typeahead.js rate-limits remote requests
        // limit: 5,  					 // can limit results if need be
        cache: false, 					 // set to true when done with development
        minLength: 4 					 // min length of chars needed before Autocomplete kicks in
        // header: '<p class="section-title">Vehicle Testing Station details</p>'
      }
    ]).on('typeahead:selected', function (e, data) { 
      $('#test-item-selector-btn-search').click();
    }).on('typeahead:autocompleted', function (e, data) {
      $('#test-item-selector-btn-search').click();
    });
}

function setupTypeaheadOnTester() { // Shove this into a function to make it easily re-usable
    $('#vts-search').typeahead([		// typeahead.js usage info here: https://github.com/twitter/typeahead.js
     {
        name: 'testerData',
        prefetch: '/data/Tester-data.json', 
        // limit: 5,  					 // can limit results if need be
        cache: false, 					 // set to true when done with development
        minLength: 4    				 // min length of chars needed before Autocomplete kicks in
      }
    ]).on('typeahead:selected', function (e, data) { 
      $('#test-item-selector-btn-search').click();
    }).on('typeahead:autocompleted', function (e, data) {
      $('#test-item-selector-btn-search').click();
    });
}

/* <![CDATA[ */
$(document).ready(function() {

	// Prepopulate date ranges with current month & year - to make things quicker/easier
	var nowDate = new Date();
	var month = (nowDate.getMonth()+1);
	if (month <= 9) {month = '0'+month;}
	var year = nowDate.getFullYear();
	log("Current month/year = " + month + "/" + year);
	$('#month1, #month2').val(month);
	$('#year1, #year2').val(year);	
	$('#dateRangeFields').hide(); // Then hide it until it's needed


	setupTypeaheadOnVTS();

    // If search entity changes - then change the search input placeholder text example..
    // and remove or change the typeahead 
    $('#searchEntity').on('change',function () {
    	switch($(this)[0].selectedIndex)
		{
		case 0: // VTS
		  log('VTS/Site selected');
		  $('#vts-search').attr('placeholder','eg. V12345');
		  $('#vts-search').unbind(); // remove the typeahead (to be safe)
		  setupTypeaheadOnVTS();     // re-apply the typeahead
		  $('#dateRangeFields').hide('slow');
		  $('#vts-search-form').attr('action','listMOTs.html'); // change destination page
		  break;
		case 1: // VTS-date
		  log('VTS/Site by date-range selected');
		  $('#vts-search').attr('placeholder','eg. V12345');
		  $('#vts-search').unbind(); // remove the typeahead
		  setupTypeaheadOnVTS();     // re-apply the typeahead
		  $('#dateRangeFields').show('slow');
		  $('#vts-search-form').attr('action','listVehicleMOTs.html'); // change destination page
		  break;
		case 2: // Tester-date
		  log('Tester by date-range selected');
		  $('#vts-search').attr('placeholder','eg. SHEA0007');
		  $('#vts-search').unbind(); // remove the typeahead
		  setupTypeaheadOnTester();     // Apply the typeahead for Testers
		  $('#dateRangeFields').show('slow');
		  $('#vts-search-form').attr('action','listVehicleMOTs.html'); // change destination page
		  break;
		case 3: // Registration
		  log('Registration selected');
		  $('#vts-search').attr('placeholder','eg. VK02 MOT');
		  $('#vts-search').unbind(); // remove the typeahead
		  $('#dateRangeFields').hide('slow');
		  $('#vts-search-form').attr('action','listVehicleMOTs.html'); // change destination page
		  break;
		case 4: // VIN/Chassis
		  log('VIN/Chassis selected');
		  $('#vts-search').attr('placeholder','eg. WV1ZZZ8ZH6H091596');
		  $('#vts-search').unbind(); // remove the typeahead
		  $('#dateRangeFields').hide('slow');
		  $('#vts-search-form').attr('action','listVehicleMOTs.html'); // change destination page
		  break;
		default:
		  log('should not see this');
		}
    })


});

// Don't forget some date validation (using jQuery 'validate' plugin)

/* ]]> */
</script>

</div> <!-- /container -->
</body>
</html>
